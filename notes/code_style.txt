# Style guide references

- We care about at consistency rather than arguing about which approach is better
  - E.g., see "tab vs space" flame-war from the 90s
- Unless explicitly noted we prefer to follow the style guide below

## Reference

- Google Python Style (GPS) Guide
  - `https://google.github.io/styleguide/pyguide.html`

- Commenting style
  - `http://www.sphinx-doc.org/en/master/`
  - `https://thomas-cokelaer.info/tutorials/sphinx/docstring_python.html`

- Code convention PEP8
    - `https://www.python.org/dev/peps/pep-0008/`

- Documentation best practices
    - `https://github.com/google/styleguide/blob/gh-pages/docguide/best_practices.md`

- Philosophical stuff
    - `https://github.com/google/styleguide/blob/gh-pages/docguide/philosophy.md`

- Unix rules (although a bit cryptic sometimes)
    - `https://en.wikipedia.org/wiki/Unix_philosophy#Eric_Raymond%E2%80%99s_17_Unix_Rules`

# Comments

## Descriptive vs imperative style
- GPS suggests to use descriptive comments, e.g., "This function describes",
  instead than imperative
- pylint and other python QA tools favor an imperative style
- Since we prefer to rely on automatic checks, we decided to use an imperative
  style of comments

## Commenting

### Docstring conventions

- Code needs to be properly commented

- We follow python standard [PEP257](https://www.python.org/dev/peps/pep-0257/)
  for commenting
    - PEP257 standardizes what and how comments should be expressed (e.g., use a
      triple quotes for commenting a function), but it does not specify what
      markup syntax should be used to describe comments

- Different conventions have been developed for documenting interfaces
    - reST
    - Google (which is cross-language, e.g., C++, python, …)
    - epytext
    - numpydoc

- reST (aka re-Structured Text) style is the most widely supported

```python
"""
This is a reST style.

:param param1: this is a first param
:type param1: str
:param param2: this is a second param
:type param2: int
:returns: this is a description of what is returned
:rtype: bool
:raises keyError: raises an exception
"""
```

- supported by all doc generation tools (e.g., epydoc, sphinx)
- default in pycharm
- default in pyment
-  supported by pydocstyle (which doesn’t support Google style as explained
   [here](https://github.com/PyCQA/pydocstyle/issues/275))

#### Alternative parameter description and type

- Note that we prefer to alternate param description and its type so the
  docstring below, although good, doesn’t follow our convention.

**Bad**
```python
:param data: CB data
:param metrics: CB metrics
:param fill_na_w_zero: If True, fill NaN values with zeros.

:type data: pd.DataFrame
:type metrics: list of str
:type fill_na_w_zero: bool

:returns data_merged: Data with two metrics added together.
:rtype data_merged: pd.DataFrame
```

- The code should be changed into:
```python
:param data: CB data
:type data: pd.DataFrame
:param metrics: CB metrics
:type metrics: list of str
:param fill_na_w_zero: If True, fill NaN values with zeros.
:type fill_na_w_zero: bool

:returns data_merged: Data with two metrics added together.
:rtype data_merged: pd.DataFrame
```

- Examples are
  [here](https://stackoverflow.com/questions/3898572/what-is-the-standard-python-docstring-format).

- `linter.py` uses [pydocstyle](http://www.pydocstyle.org/en/2.1.1/index.html), a
  static analysis tool for checking compliance with Python docstring conventions
  with PEP257.

### Avoid empty lines in code

- If you feel that you need an empty line in the code, it probably means that a
  specific chunk of code is a logical piece of code performing a cohesive
  function.
    ```python
    ...
    end_y = end_dt.year
    # Generate list of file paths for ParquetDataset.
    paths = list()
    ...
    ```

- Instead of putting an empty line, you should put a comment describing at high
  level what the code does.
    ```python
    ...
    end_y = end_dt.year
    # Generate list of file paths for ParquetDataset.
    paths = list()
    ...
    ```

- If you don’t want to add just use an empty comment.
    ```python
    ...
    end_y = end_dt.year
    #
    paths = list()
    ...
    ```

- The problem with empty lines is that they are visually confusing since one
  empty line is used also to separate functions. For this reason we suggest to
  use an empty comment.

### Avoid distracting comments

- Use comments to explain the high level logic / goal of a piece of code and not
  the details
    - E.g., do not comment things that are obvious, e.g.,
    ```python
    # Print results.
    log.info("Results are %s", ...)
    ```

### If you find a bug, obsolete docstring in the code
- The process is:
    - do` git blame` to find who wrote the code
    - if it’s an easy bug, you can fix it and ask for a review to the author
    - you can file a comment on Upsource
    - you can file a bug on Github with
        - clear info on the problem
        - how to reproduce it, ideally a unit test
        - stacktrace
        - you can use the tag “BUG: ..."
