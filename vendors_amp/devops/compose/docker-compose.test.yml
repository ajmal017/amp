version: '3'

services:
  app:
    image: ${IMAGE}
    entrypoint: /app/vendors_amp/devops/docker_build/entrypoints/entrypoint_deploy_postgres.sh
    depends_on:
      - kibot_postgres_test
    env_file:
      - ../env/test.env

  # TODO(gp): -> im.postgres.test:
  kibot_postgres_test:
    image: postgres:13
    # TODO(gp): -> Needed?
    container_name: kibot_postgres_test
    restart: "no"
    # volumes:
      # TODO(gp): A little difficult to maintain. Let's just use a script like
      # edgar/db/schema/version_1.0/init_index_schema.sh.
      # - ./../../common/db/sql/types.sql:/docker-entrypoint-initdb.d/0-types.sql
      # - ./../../common/db/sql/static.sql:/docker-entrypoint-initdb.d/1-static.sql
      # - ./../../common/db/sql/kibot.sql:/docker-entrypoint-initdb.d/2-kibot.sql
    env_file:
      - ../env/test.env
    ports:
      - "5551:5551"
    command: "-p 5551"
