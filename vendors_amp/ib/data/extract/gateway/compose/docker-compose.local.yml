version: '3'
services:
  extractor:
    image: ${IMAGE}
    volumes:
      - ../../../../:/amp
    entrypoint: "vendors_amp/ib/data/extract/gateway/entrypoint.sh"
    environment:
      - IB_GW_CONNECTION_PORT=${API_PORT}
    env_file:
      - ../.env/local.env
    depends_on:
      - tws

  tws:
    image: 083233266530.dkr.ecr.us-east-2.amazonaws.com/ib_connect:prod
    container_name: "ib_connect_local"
    entrypoint: "vendors_amp/ib/connect/entrypoint.sh"
    environment:
      - APP=GATEWAY
      # No trusted IP-s, so it is possible to connect only from localhost.
      - VNC_PASSWORD=12345
      - VNC_TRUSTED_IPS=
      - API_PORT=${API_PORT}
      - VNC_PORT=${VNC_PORT}
    env_file:
      - ~/.vnc/ib.credentials
      - ../.env/local.env
    ports:
      - "${VNC_PORT}:${VNC_PORT}"
      - "${API_PORT}:${API_PORT}"
